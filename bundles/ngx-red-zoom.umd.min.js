!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-red-zoom",["exports","@angular/core","@angular/common"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ngx-red-zoom"]={},e.ng.core,e.ng.common)}(this,(function(e,t,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var s,r,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e}Object.create;var o,a=(o=null,function(){return o||((o=document.createElement("template")).innerHTML='<div class="red-zoom">\n                <div class="red-zoom__overlay"></div>\n                <div class="red-zoom__frame">\n                    <div class="red-zoom__frame-body"></div>\n                </div>\n                <div class="red-zoom__lens">\n                    <div class="red-zoom__lens-body"></div>\n                </div>\n                <div class="red-zoom__error">\n                    <div class="red-zoom__error-message"></div>\n                </div>\n            </div>'),o.content.cloneNode(!0).firstChild}),l=function(){function e(){var e=this;this._status=null,this.appliedClasses=[],this.onTransitionEnd=function(t){"visibility"===t.propertyName&&e.isHidden&&e.template.remove()},this.template=a(),this.lens=this.template.querySelector(".red-zoom__lens"),this.lensBody=this.template.querySelector(".red-zoom__lens-body"),this.frame=this.template.querySelector(".red-zoom__frame"),this.frameBody=this.template.querySelector(".red-zoom__frame-body"),this.error=this.template.querySelector(".red-zoom__error"),this.errorMessage=this.template.querySelector(".red-zoom__error-message"),this.template.addEventListener("transitionend",this.onTransitionEnd),this.status="loading"}return Object.defineProperty(e.prototype,"status",{get:function(){return this._status},set:function(e){null!==this._status&&this.template.classList.remove("red-zoom--status--"+this._status),this._status=e,this.template.classList.add("red-zoom--status--"+e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"classes",{set:function(e){var t,n;(t=this.template.classList).remove.apply(t,i(this.appliedClasses)),(e=e.trim())&&(this.appliedClasses=e.replace(/ +/," ").split(" "),(n=this.template.classList).add.apply(n,i(this.appliedClasses)))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return"hidden"===getComputedStyle(this.template).visibility},enumerable:!1,configurable:!0}),e.prototype.setProperties=function(e){for(var t in e)this.template.style.setProperty(t,e[t])},e.prototype.detach=function(){this.template.classList.remove("red-zoom--active"),this.isHidden&&this.template.remove()},e.prototype.attach=function(){this.template.parentNode!==document.body&&document.body.appendChild(this.template)},e.prototype.activate=function(){this.template.classList.add("red-zoom--active")},e}(),m=function(){function e(e,t,n){var s=this;void 0===e&&(e=null),void 0===t&&(t=function(){}),void 0===n&&(n=null),this.element=e,this.listener=t,this.loading=!1,this.isFirst=!0,null===e&&(this.element=document.createElement("img"));var r=function(){"loading"!==s.status&&(s.isFirst=!1),s.listener()};this.element.addEventListener("load",r),this.element.addEventListener("error",r),this.destroy=function(){s.element.removeEventListener("load",r),s.element.removeEventListener("error",r)},null!==n&&this.element.classList.add(n)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.element.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.element.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return{x:this.width,y:this.height}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"naturalWidth",{get:function(){return this.element.naturalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"naturalHeight",{get:function(){return this.element.naturalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"naturalSize",{get:function(){return{x:this.naturalWidth,y:this.naturalHeight}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.element.style},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleSize",{set:function(e){this.element.style.width=e.x,this.element.style.height=e.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.loading?"loading":this.element.complete&&this.element.src?0===this.naturalWidth?"error":"loaded":"loading"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"src",{set:function(e){this.loading=!1,this.element.setAttribute("src",e)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.loading=!0,this.listener()},e}();function u(e,t,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"min":return Math.min(e,n);case"max":return Math.max(e,n)}}function c(e){return{x:e.width,y:e.height}}function h(){return{x:scrollX,y:scrollY}}function d(e){return f({x:e.clientX,y:e.clientY},h())}function p(e,t,n){return"number"==typeof n&&(n={x:n,y:n}),{x:u(e.x,t,n.x),y:u(e.y,t,n.y)}}function f(e,t){return p(e,"+",t)}function g(e,t){return p(e,"-",t)}function y(e,t){return p(e,"*",t)}function b(e,t){return p(e,"/",t)}function v(e,t){return p(e,"min",t)}function z(e,t){return p(e,"max",t)}function S(e){return x(e,Math.round)}function x(e,t){return{x:t(e.x,"x"),y:t(e.y,"y")}}function I(e){return Math.max(e.x,e.y)}var P=function(){function e(e,t,n,s){var r,i=this;this.element=e,this.renderer=t,this.zone=n,this.platformId=s,this.lazy=!1,this.classes="",this.behavior="hover",this.wheel=!0,this.errorMessage="An error occurred while loading the image.",this.scaleFactor=1,this.requestAnimationFrameId=null,this.unlisten=function(){},this.onImageChangeStatus=function(){r!==i.status&&(r=i.status,i.onImageChangeStatusDistinct())},this.onImageChangeStatusDistinct=function(){i.template.status=i.status,"loaded"===i.status&&(i.template.setProperties({"--red-zoom-lens-image-natural-w":i.lensImage.naturalWidth+"px","--red-zoom-lens-image-natural-h":i.lensImage.naturalHeight+"px"}),i.session&&i.session.active&&(i.calcScaleFactor(),i.calcFrameSize(),i.move(),i.scaleFactor=i.lensImage.width/i.lensImage.naturalWidth))},this.mouseEnter=function(e){e.cancelable&&e.preventDefault(),i.session&&i.session.destroy(),i.session={active:!1,thumbSize:null,thumbPos:null,lensContainerSize:null,lensImageSize:null,frameSize:null,mousePos:d(e),destroy:function(){}};var t,n,s,r=function(e){i.onMouseMove(d(e))},o=function(){i.session=null,i.template.detach(),t(),n(),s()};"hover"===i.behavior?(t=i.renderer.listen(i.element.nativeElement,"mousemove",r),n=i.renderer.listen(i.element.nativeElement,"mouseleave",o)):"click"===i.behavior?(t=function(){},n=i.renderer.listen(document,"mousedown",(function(e){i.element.nativeElement.contains(e.target)||o()}))):(t=i.renderer.listen(document,"mousemove",r),n=i.renderer.listen(document,"mouseup",o)),s=i.renderer.listen(i.element.nativeElement,"wheel",(function(e){if(e.cancelable&&"loaded"===i.status&&i.wheel){e.preventDefault();var t=Math.sign(e.deltaY),n=i.scaleFactor+.01*-t;console.log(n),void 0!==i.minScaleFactor&&n<i.minScaleFactor||void 0!==i.maxScaleFactor&&n>i.maxScaleFactor||(i.scaleFactor+=.01*-t,i.calcScaleFactor(),i.calcFrameSize(),i.onMouseMove("click"===i.behavior?i.session.mousePos:d(e)))}})),i.onMouseMove(d(e)),i.forceReflow(),i.template.activate(),"loaded"!==i.status&&(i.loadLensImage(),i.loadFrameImage()),i.session.destroy=o},this.onMouseMove=function(e){i.isImage&&"loaded"!==i.thumbImage.status&&i.thumbImage.isFirst||(i.session.active||(i.session.active=!0,i.initSession()),i.session.mousePos=e,"loaded"===i.status&&(cancelAnimationFrame(i.requestAnimationFrameId),i.requestAnimationFrameId=requestAnimationFrame((function(){return i.move()}))))}}return Object.defineProperty(e.prototype,"isImage",{get:function(){return"IMG"===this.element.nativeElement.tagName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){var e,t,n="loaded",r=[this.frameImage,this.lensImage];this.isImage&&r.push(this.thumbImage);try{for(var i=s(r),o=i.next();!o.done;o=i.next()){var a=o.value;"error"===n||"error"===a.status?n="error":"loading"!==n&&"loading"!==a.status||(n="loading")}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),e.prototype.listen=function(){var e={hover:"mouseenter",grab:"mousedown",click:"mousedown"}[this.behavior];this.unlisten(),this.unlisten=this.renderer.listen(this.element.nativeElement,e,this.mouseEnter)},e.prototype.ngAfterContentInit=function(){var e=this;n.isPlatformBrowser(this.platformId)&&this.zone.runOutsideAngular((function(){e.template=new l,e.template.classes=e.classes,e.template.errorMessage.innerHTML=e.errorMessage,e.isImage&&(e.thumbImage=new m(e.element.nativeElement,e.onImageChangeStatus)),e.frameImage=new m(null,e.onImageChangeStatus,"red-zoom__frame-image"),e.lensImage=new m(null,e.onImageChangeStatus,"red-zoom__lens-image"),e.lazy||(e.loadFrameImage(),e.loadLensImage()),e.listen()}))},e.prototype.ngOnChanges=function(e){n.isPlatformBrowser(this.platformId)&&("src"in e&&!e.src.firstChange&&this.onChangeThumbSrc(),"thumbSrc"in e&&!e.thumbSrc.firstChange&&this.onChangeThumbSrc(),"lensSrc"in e&&!e.lensSrc.firstChange&&this.onChangeLensSrc(),"behavior"in e&&!e.behavior.firstChange&&this.listen(),"classes"in e&&!e.classes.firstChange&&(this.template.classes=this.classes,this.invalidate()),"errorMessage"in e&&!e.errorMessage.firstChange&&(this.template.errorMessage.innerHTML=this.errorMessage))},e.prototype.ngOnDestroy=function(){n.isPlatformBrowser(this.platformId)&&this.session&&this.session.destroy()},e.prototype.onChangeThumbSrc=function(){this.frameImage.reset(),this.lazy&&!this.session||this.loadFrameImage()},e.prototype.onChangeLensSrc=function(){this.lensImage.reset(),this.lazy&&!this.session||this.loadLensImage()},e.prototype.getThumbSrc=function(){return this.isImage&&this.src?this.src:this.thumbSrc},e.prototype.loadLensImage=function(){"loaded"!==this.lensImage.status&&(this.lensImage.src=this.lensSrc)},e.prototype.loadFrameImage=function(){"loaded"!==this.frameImage.status&&(this.frameImage.src=this.getThumbSrc())},e.prototype.initSession=function(){var e,t,n=this.element.nativeElement.getBoundingClientRect();this.session.thumbSize=c(n),this.session.thumbPos=f({x:(e=n).left,y:e.top},h()),this.template.attach(),this.template.lensBody.appendChild(this.lensImage.element),this.template.frameBody.appendChild(this.frameImage.element),this.template.setProperties({"--red-zoom-thumb-x":this.session.thumbPos.x+"px","--red-zoom-thumb-y":this.session.thumbPos.y+"px","--red-zoom-thumb-w":this.session.thumbSize.x+"px","--red-zoom-thumb-h":this.session.thumbSize.y+"px","--red-zoom-thumb-size-max":I(this.session.thumbSize)+"px","--red-zoom-thumb-size-min":(t=this.session.thumbSize,Math.min(t.x,t.y)+"px")}),"loaded"===this.status&&(this.calcScaleFactor(),this.calcFrameSize(),this.scaleFactor=this.lensImage.width/this.lensImage.naturalWidth)},e.prototype.calcScaleFactor=function(){var e,t,n=y(this.lensImage.naturalSize,this.scaleFactor);this.lensImage.styleSize=x(n,(function(e){return e+"px"})),function(e){return e.x||e.y}((e=this.lensImage.size,t=S(n),{x:e.x!==t.x,y:e.y!==t.y}))&&(this.scaleFactor=I(b(this.lensImage.size,this.lensImage.naturalSize)),this.lensImage.styleSize=x(y(this.lensImage.naturalSize,this.scaleFactor),(function(e){return e+"px"})))},e.prototype.calcFrameSize=function(){this.session.lensContainerSize=c(this.template.lensBody.getBoundingClientRect()),this.session.lensImageSize=c(this.lensImage.element.getBoundingClientRect()),this.session.frameSize=v(this.session.thumbSize,S(y(this.session.thumbSize,b(this.session.lensContainerSize,this.session.lensImageSize)))),this.template.setProperties({"--red-zoom-frame-w":this.session.frameSize.x+"px","--red-zoom-frame-h":this.session.frameSize.y+"px"})},e.prototype.move=function(){if(this.session&&this.session.active){var e=this.session,t=e.mousePos,n=e.thumbSize,s=e.thumbPos,r=e.frameSize,i=e.lensContainerSize,o=e.lensImageSize;this.template.setProperties({"--red-zoom-mouse-x":t.x+"px","--red-zoom-mouse-y":t.y+"px"});var a=g(t,b(r,2)),l=v(z(a,s),g(f(s,n),r)),m=g(s,S(l));this.template.setProperties({"--red-zoom-frame-x":Math.round(l.x)+"px","--red-zoom-frame-y":Math.round(l.y)+"px","--red-zoom-frame-image-x":Math.round(m.x)+"px","--red-zoom-frame-image-y":Math.round(m.y)+"px"});var u=y(x(g(n,r),(function(e,t){return 0===e?0:(l[t]-s[t])/e})),g(o,i)),c=z(b(g(i,o),2),0),h=y(b(g(a,l),b(r,2)),b(i,2));this.template.setProperties({"--red-zoom-lens-image-base-x":-u.x+"px","--red-zoom-lens-image-base-y":-u.y+"px","--red-zoom-lens-image-center-offset-x":c.x+"px","--red-zoom-lens-image-center-offset-y":c.y+"px","--red-zoom-lens-image-frame-offset-x":-h.x+"px","--red-zoom-lens-image-frame-offset-y":-h.y+"px"})}},e.prototype.invalidate=function(){this.session&&this.session.active&&(this.initSession(),this.move())},e.prototype.forceReflow=function(){this.element.nativeElement.getBoundingClientRect()},e}();P.decorators=[{type:t.Directive,args:[{selector:"[redZoom]",exportAs:"redZoom"}]}],P.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer2},{type:t.NgZone},{type:String,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]},P.propDecorators={src:[{type:t.Input,args:["src"]},{type:t.HostBinding,args:["attr.src"]}],lensSrc:[{type:t.Input,args:["redZoom"]}],thumbSrc:[{type:t.Input,args:["redZoomThumb"]}],lazy:[{type:t.Input,args:["redZoomLazy"]}],classes:[{type:t.Input,args:["redZoomClass"]}],behavior:[{type:t.Input,args:["redZoomBehavior"]}],wheel:[{type:t.Input,args:["redZoomMouseWheel"]}],minScaleFactor:[{type:t.Input}],maxScaleFactor:[{type:t.Input}],errorMessage:[{type:t.Input,args:["redZoomErrorMessage"]}]};var _=function(){};_.decorators=[{type:t.NgModule,args:[{declarations:[P],exports:[P]}]}],e.RedZoomDirective=P,e.RedZoomModule=_,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-red-zoom.umd.min.js.map